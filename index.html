<!DOCTYPE html>
<html lang="es-PE">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inteligencia Comercial | ADEX Escuela</title>
    
    <!-- Favicon ADEX -->
    <link rel="icon" href="https://favicon.im/www.adexperu.org.pe" />
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        adex: {
                            blue: '#003399',
                            darkBlue: '#001a4d',
                            red: '#cc0000',
                            gray: '#f8fafc'
                        }
                    },
                    boxShadow: {
                        'nav': '0 -8px 30px rgba(0,0,0,0.08)',
                        'header': '0 4px 30px rgba(0,0,0,0.03)',
                        'card': '0 10px 25px rgba(0, 0, 0, 0.05)',
                        'card-hover': '0 20px 40px rgba(0, 51, 153, 0.15)'
                    }
                }
            }
        }
    </script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* PROTECCIÓN ANTICOPIA Y ANTI-SELECCIÓN ESTRICTA */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Permitir escribir solo en los buscadores */
        input[type="text"] {
            -webkit-user-select: auto;
            -khtml-user-select: auto;
            -moz-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }

        body { 
            background-color: #f8fafc; 
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Efectos Glassmorphism modernos */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255,255,255,0.5);
        }

        /* Animaciones de Tarjetas */
        .tool-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: center;
        }
        .tool-card:active {
            transform: scale(0.96);
        }
        .tool-card:hover {
            transform: translateY(-8px);
        }
        
        /* Animación de la Estrella */
        .star-btn {
            transition: transform 0.2s ease;
        }
        .star-btn:active {
            transform: scale(0.8);
        }
        @keyframes starPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.5) rotate(15deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        .star-animated {
            animation: starPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Entrada de elementos */
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-enter {
            animation: slideUpFade 0.5s ease-out forwards;
        }
    </style>
</head>
<body oncontextmenu="return false;" class="text-slate-800 antialiased h-screen flex flex-col overflow-hidden">

    <!-- ENCABEZADO SUPERIOR -->
    <header class="bg-white shadow-header z-40 shrink-0 border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-4 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                
                <!-- Branding ADEX Escuela -->
                <div class="flex items-center gap-3">
                    <div class="bg-slate-50 p-2 rounded-2xl border border-slate-100 shadow-sm">
                        <img src="https://favicon.im/www.adexperu.org.pe" alt="ADEX" class="w-8 h-8 object-contain">
                    </div>
                    <div class="flex flex-col">
                        <span class="text-2xl font-black text-adex-darkBlue leading-none tracking-tight">ADEX</span>
                        <span class="text-[10px] font-black text-adex-red uppercase tracking-[0.3em] leading-tight">Escuela</span>
                    </div>
                </div>

                <!-- Créditos del Desarrollador -->
                <div class="flex items-center bg-slate-50 pl-1.5 pr-4 py-1.5 rounded-full border border-slate-200 shadow-sm">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-adex-red to-orange-500 text-white flex items-center justify-center font-bold text-xs shadow-md mr-2">
                        EM
                    </div>
                    <div class="flex flex-col text-right">
                        <span class="text-[9px] uppercase tracking-wider text-slate-400 font-bold">Desarrollo</span>
                        <span class="text-xs font-black text-slate-800">Eric Mozombite</span>
                    </div>
                </div>
            </div>

            <!-- Buscador Universal -->
            <div class="mt-5 relative group">
                <i class="ph-bold ph-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xl group-focus-within:text-adex-blue transition-colors"></i>
                <input type="text" id="search-input" placeholder="Buscar por nombre, categoría o palabra clave..." 
                    class="w-full bg-slate-100/80 border-2 border-transparent rounded-2xl pl-12 pr-4 py-3.5 text-sm font-semibold text-slate-800 focus:bg-white focus:border-adex-blue/30 focus:shadow-md transition-all outline-none placeholder:text-slate-400 placeholder:font-medium">
            </div>
        </div>

        <!-- Filtros por Categoría (Scroll Horizontal) -->
        <div class="border-t border-slate-100 bg-white">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex items-center gap-2 overflow-x-auto hide-scrollbar py-3" id="category-nav">
                    <!-- Inyectado vía JS -->
                </div>
            </div>
        </div>
    </header>

    <!-- ÁREA DE CONTENIDO (Grilla de Herramientas) -->
    <!-- pb-32 es el padding clave para que la navegación flotante inferior no tape la última tarjeta -->
    <main class="flex-1 overflow-y-auto w-full relative pt-6 pb-36" id="main-container">
        <div class="max-w-7xl mx-auto px-4 lg:px-8">
            
            <!-- Encabezado de Vista -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 id="view-title" class="text-2xl lg:text-3xl font-black text-slate-900 tracking-tight">Directorio Completo</h2>
                    <p id="view-desc" class="text-sm text-slate-500 mt-1 font-medium">Toca cualquier tarjeta para abrirla.</p>
                </div>
                <div class="bg-white px-3 py-1 rounded-full border border-slate-200 shadow-sm">
                    <span id="results-count" class="text-xs font-bold text-adex-blue">0</span>
                </div>
            </div>

            <!-- Grilla Principal -->
            <div id="tools-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
                <!-- Tarjetas inyectadas vía JS -->
            </div>

            <!-- Estado Vacío -->
            <div id="empty-state" class="hidden flex-col items-center justify-center py-20 text-center animate-enter">
                <div class="w-24 h-24 bg-white shadow-sm border border-slate-100 rounded-3xl flex items-center justify-center mb-6 rotate-3">
                    <i id="empty-icon" class="ph-duotone ph-star text-6xl text-slate-300"></i>
                </div>
                <h3 id="empty-title" class="text-xl font-black text-slate-800 mb-2">No hay herramientas</h3>
                <p id="empty-desc" class="text-sm text-slate-500 max-w-xs mx-auto font-medium">No se encontraron resultados para tu búsqueda actual.</p>
            </div>
            
            <!-- Espaciador final para asegurar el scroll completo -->
            <div class="h-10 w-full"></div>
        </div>
    </main>

    <!-- NAVEGACIÓN INFERIOR FLOTANTE -->
    <div class="fixed bottom-0 left-0 right-0 z-50 pb-safe pt-2 pointer-events-none">
        <div class="max-w-md mx-auto px-4 pb-6 pointer-events-auto">
            <nav class="glass-panel shadow-nav rounded-3xl p-2 flex justify-between items-center relative overflow-hidden">
                <!-- Indicador activo (Fondo) -->
                <div id="nav-indicator" class="absolute w-1/2 h-full top-0 left-0 bg-white/60 rounded-3xl transition-transform duration-300 ease-out z-0"></div>
                
                <!-- Botón Directorio -->
                <button onclick="changeView('all')" id="nav-btn-all" class="relative z-10 flex-1 flex flex-col items-center justify-center py-3 text-adex-blue transition-colors">
                    <i id="icon-all" class="ph-fill ph-squares-four text-2xl mb-1"></i>
                    <span class="text-[10px] font-black uppercase tracking-wider">Directorio</span>
                </button>
                
                <!-- Botón Favoritos -->
                <button onclick="changeView('favorites')" id="nav-btn-fav" class="relative z-10 flex-1 flex flex-col items-center justify-center py-3 text-slate-400 hover:text-yellow-500 transition-colors">
                    <div class="relative">
                        <i id="icon-fav" class="ph-bold ph-star text-2xl mb-1 transition-all"></i>
                        <span id="fav-badge" class="absolute -top-1.5 -right-2.5 bg-adex-red text-white text-[9px] font-black w-4 h-4 rounded-full flex items-center justify-center shadow-sm hidden">0</span>
                    </div>
                    <span class="text-[10px] font-black uppercase tracking-wider">Favoritos</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- SCRIPTS DE SEGURIDAD -->
    <script>
        // Bloquear clic derecho
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // Bloquear atajos de teclado para copiar o inspeccionar
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'x' || e.key === 'a' || e.key === 'u' || e.key === 's')) e.preventDefault();
            if (e.key === 'F12') e.preventDefault();
        });

        // Prevenir arrastrar imágenes o links
        document.addEventListener('dragstart', e => e.preventDefault());
    </script>

    <!-- LÓGICA DE LA APLICACIÓN -->
    <script>
        // 1. BASE DE DATOS
        const toolsData = [
            { id: "t1", cat: "Nacional (Perú)", name: "SUNAT", desc: "Verifica formalidad de empresas (Consulta RUC), exportadoras y operatividad aduanera.", tags: ["RUC", "Aduanas"], url: "https://e-consultaruc.sunat.gob.pe/", icon: "ph-buildings" },
            { id: "t2", cat: "Nacional (Perú)", name: "INEI", desc: "Zonas de producción, Estadísticas de Producción Nacional y censos demográficos.", tags: ["Censo", "PBI"], url: "https://www.gob.pe/inei", icon: "ph-chart-pie-slice" },
            { id: "t3", cat: "Nacional (Perú)", name: "SIEA MIDAGRI", desc: "Calendario de producción agrícola, cosechas y estadísticas del sector agrario.", tags: ["Agro", "Cosecha"], url: "https://siea.midagri.gob.pe/portal/", icon: "ph-plant" },
            { id: "t4", cat: "Nacional (Perú)", name: "Catálogo MIDAGRI", desc: "Directorio oficial de proveedores y productores agrarios a nivel nacional.", tags: ["Proveedores", "Agro"], url: "https://catalogo.midagri.gob.pe/", icon: "ph-address-book" },
            { id: "t5", cat: "Nacional (Perú)", name: "PRODUCE", desc: "Datos de producción marina (pesca y acuicultura) e industrial.", tags: ["Pesca", "Industria"], url: "https://ogeiee.produce.gob.pe", icon: "ph-factory" },
            { id: "t6", cat: "Nacional (Perú)", name: "SERFOR", desc: "Estadísticas sobre hierbas, flora, fauna silvestre y productos forestales.", tags: ["Madera", "Flora"], url: "https://sniffs.serfor.gob.pe", icon: "ph-tree" },
            { id: "t7", cat: "Nacional (Perú)", name: "ADT (ADEX)", desc: "Importaciones y exportaciones peruanas detalladas por puerto y aduana.", tags: ["ADEX", "Puertos"], url: "https://www.adexdatatrade.com", icon: "ph-chart-line-up" },
            { id: "t8", cat: "Nacional (Perú)", name: "Veritrade", desc: "Inteligencia comercial y búsqueda directa de empresas importadoras reales.", tags: ["Competencia", "Importadores"], url: "https://www.veritradecorp.com", icon: "ph-detective" },
            { id: "t9", cat: "Nacional (Perú)", name: "Acuerdos Comerciales", desc: "Portal oficial de los TLCs y acuerdos comerciales vigentes del Perú.", tags: ["TLC", "Convenios"], url: "https://www.acuerdoscomerciales.gob.pe", icon: "ph-handshake" },
            { id: "t10", cat: "Nacional (Perú)", name: "Tu Mercado Perú", desc: "Directorio de PROMPERÚ que conecta oferta regional con compradores globales.", tags: ["PromPerú", "B2B"], url: "https://www.tumercadoperu.com", icon: "ph-storefront" },
            
            { id: "t11", cat: "Riesgo y Entorno", name: "EPI Yale", desc: "Índice de Desempeño Ambiental. Evalúa la sostenibilidad ecológica por país.", tags: ["Medio Ambiente", "EPI"], url: "https://epi.yale.edu/measure/2024/EPI", icon: "ph-leaf" },
            { id: "t12", cat: "Riesgo y Entorno", name: "Transparency Int.", desc: "Índice de Percepción de la Corrupción. Mide riesgo ético institucional.", tags: ["Corrupción", "Ética"], url: "https://www.transparency.org/en/cpi/2025", icon: "ph-scales" },
            { id: "t13", cat: "Riesgo y Entorno", name: "Doing Business", desc: "Ranking del Banco Mundial sobre facilidad de negocios y regulaciones.", tags: ["Trámites", "Inversión"], url: "https://archive.doingbusiness.org/es/rankings", icon: "ph-briefcase" },
            { id: "t14", cat: "Riesgo y Entorno", name: "COFACE", desc: "Análisis macroeconómico, insights y mapas de evaluación de riesgo país.", tags: ["Riesgo País", "Impago"], url: "https://www.coface.com.pe", icon: "ph-warning-circle" },
            { id: "t15", cat: "Riesgo y Entorno", name: "CESCE", desc: "Gestión de seguros de crédito a la exportación e información de riesgo.", tags: ["Seguros", "Crédito"], url: "https://www.cesce.es", icon: "ph-shield-check" },
            { id: "t16", cat: "Riesgo y Entorno", name: "CIAL D&B", desc: "Software financiero para evaluar solvencia y riesgo en transacciones B2B.", tags: ["Solvencia", "D&B"], url: "https://www.cialdnb.com", icon: "ph-bank" },

            { id: "t17", cat: "Mercado y Estadísticas", name: "Trade Map", desc: "Filtra flujos de importación y exportación a nivel mundial por partida.", tags: ["Flujos", "Competencia"], url: "https://www.trademap.org", icon: "ph-globe-hemisphere-east" },
            { id: "t18", cat: "Mercado y Estadísticas", name: "FAO STAT", desc: "Data estadística global sobre agricultura, producción de alimentos y ganadería.", tags: ["FAO", "Alimentos"], url: "https://www.fao.org/faostat/", icon: "ph-wheat" },
            { id: "t19", cat: "Mercado y Estadísticas", name: "CIA Factbook", desc: "Indicadores geográficos, económicos, demográficos y ambientales por país.", tags: ["CIA", "Perfil país"], url: "https://www.cia.gov/the-world-factbook/", icon: "ph-book-open" },
            { id: "t20", cat: "Mercado y Estadísticas", name: "Euromonitor", desc: "Inteligencia sobre tendencias de mercado, consumo y análisis de competencia.", tags: ["Tendencias", "Retail"], url: "https://www.euromonitor.com", icon: "ph-trend-up" },
            { id: "t21", cat: "Mercado y Estadísticas", name: "AUMA Ferias", desc: "Buscador de ferias internacionales con un enfoque técnico y calidad alemana.", tags: ["Ferias", "Eventos"], url: "https://www.auma.de/en", icon: "ph-ticket" },
            { id: "t22", cat: "Mercado y Estadísticas", name: "nFerias", desc: "Directorio global comercial de exposiciones, congresos y convenciones.", tags: ["Exposiciones", "B2B"], url: "https://www.nferias.com", icon: "ph-presentation-chart" },
            { id: "t23", cat: "Mercado y Estadísticas", name: "INEI Mundial", desc: "Directorio oficial con enlaces a los institutos de estadística de 195 países.", tags: ["Censos", "Directorio"], url: "https://www.gob.pe/14796", icon: "ph-list-numbers" },

            { id: "t24", cat: "Logística y Tránsito", name: "LPI (Banco Mundial)", desc: "Índice de Desempeño Logístico. Evalúa aduanas, envíos e infraestructura.", tags: ["LPI", "Aduanas"], url: "https://lpi.worldbank.org/international/global", icon: "ph-truck" },
            { id: "t25", cat: "Logística y Tránsito", name: "Rutas Marítimas", desc: "Calcula líneas navieras, rutas directas y tiempos de tránsito (PromPerú).", tags: ["Fletes", "Navieras"], url: "https://rutasmaritimas.promperu.gob.pe/", icon: "ph-boat" },
            { id: "t26", cat: "Logística y Tránsito", name: "SeaRates", desc: "Buscador de fletes globales, distancias y rastreo de contenedores en vivo.", tags: ["Tracking", "Rutas"], url: "https://www.searates.com/", icon: "ph-map-pin-line" },

            { id: "t27", cat: "Barreras y Aranceles", name: "Access2Markets", desc: "Calcula aranceles, impuestos y requisitos para ingresar a la Unión Europea.", tags: ["UE", "Aranceles"], url: "https://trade.ec.europa.eu/", icon: "ph-file-text" },
            { id: "t28", cat: "Barreras y Aranceles", name: "USITC (DataWeb)", desc: "Sistema oficial para revisar el Arancel de EE.UU. (HTS) y estadísticas.", tags: ["HTS", "USA"], url: "https://dataweb.usitc.gov", icon: "ph-flag-banner" },
            { id: "t29", cat: "Barreras y Aranceles", name: "MACMAP", desc: "Herramienta ITC para identificar barreras arancelarias y no arancelarias.", tags: ["Barreras", "Restricciones"], url: "https://www.macmap.org", icon: "ph-wall" },
            { id: "t30", cat: "Barreras y Aranceles", name: "Standards Map", desc: "Base de datos internacional de certificaciones voluntarias y normas ESG.", tags: ["Certificaciones", "ISO"], url: "https://www.standardsmap.org", icon: "ph-seal-check" },

            { id: "t31", cat: "Fuentes Regionales", name: "Exportemos.pe", desc: "Inteligencia comercial elaborada por PromPerú para las Américas.", tags: ["PromPerú", "LATAM"], url: "https://exportemos.pe", icon: "ph-compass" },
            { id: "t32", cat: "Fuentes Regionales", name: "Eurostat", desc: "Base de datos macroeconómicos y sociales oficiales de la Unión Europea.", tags: ["UE", "Estadísticas"], url: "https://ec.europa.eu/eurostat", icon: "ph-chart-pie-slice" },
            { id: "t33", cat: "Fuentes Regionales", name: "CBI Europe", desc: "Investigación de mercado especializada para exportar hacia Europa.", tags: ["Europa", "Tendencias"], url: "https://www.cbi.eu", icon: "ph-lightbulb" },
            { id: "t34", cat: "Fuentes Regionales", name: "US Census Bureau", desc: "Datos oficiales sobre la economía y demografía de los Estados Unidos.", tags: ["USA", "Censo"], url: "https://www.census.gov", icon: "ph-users" },
            { id: "t35", cat: "Fuentes Regionales", name: "PROCOMER", desc: "Promotora del Comercio Exterior de Costa Rica para el mercado centroamericano.", tags: ["Costa Rica", "Promo"], url: "https://www.procomer.com", icon: "ph-megaphone" },
            { id: "t36", cat: "Fuentes Regionales", name: "ICEX España", desc: "Entidad pública que promueve la exportación en el mercado español.", tags: ["España", "Inversión"], url: "https://www.icex.es", icon: "ph-push-pin" },
            { id: "t37", cat: "Fuentes Regionales", name: "APEX Brasil", desc: "Agencia de Promoción de Exportaciones e Inversiones de Brasil.", tags: ["Brasil", "Mercado"], url: "https://www.apexbrasil.com.br", icon: "ph-star-four" }
        ];

        // 2. ESTADO
        let state = {
            view: 'all', 
            category: 'Todas',
            search: '',
            favorites: JSON.parse(localStorage.getItem('adexFavs_EricMozombite_v2')) || []
        };

        const categories = ["Todas", "Nacional (Perú)", "Riesgo y Entorno", "Mercado y Estadísticas", "Logística y Tránsito", "Barreras y Aranceles", "Fuentes Regionales"];

        // 3. INICIALIZACIÓN
        document.getElementById('search-input').addEventListener('input', e => {
            state.search = e.target.value.toLowerCase();
            renderCards();
        });

        function init() {
            renderCategories();
            updateFavIndicators();
            renderCards();
        }

        // 4. CATEGORÍAS (Píldoras Superiores)
        function renderCategories() {
            const nav = document.getElementById('category-nav');
            nav.innerHTML = '';
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.id = `cat-${cat.replace(/\s+/g, '-').replace(/[()\/]/g, '')}`;
                btn.onclick = () => setCategory(cat);
                btn.textContent = cat;
                
                if (cat === 'Todas') {
                    btn.className = "whitespace-nowrap px-6 py-2.5 rounded-full text-sm font-bold transition-all bg-adex-darkBlue text-white shadow-md";
                } else {
                    btn.className = "whitespace-nowrap px-6 py-2.5 rounded-full text-sm font-semibold transition-all bg-white text-slate-600 border border-slate-200 hover:bg-slate-50";
                }
                nav.appendChild(btn);
            });
        }

        function setCategory(cat) {
            if(state.view === 'favorites') changeView('all'); 
            state.category = cat;
            
            document.getElementById('view-title').textContent = cat === "Todas" ? "Directorio Completo" : cat;
            document.getElementById('view-desc').textContent = cat === "Todas" ? "Toca cualquier tarjeta para abrirla." : `Mostrando herramientas de ${cat}.`;

            categories.forEach(c => {
                const btn = document.getElementById(`cat-${c.replace(/\s+/g, '-').replace(/[()\/]/g, '')}`);
                if (c === cat) {
                    btn.className = "whitespace-nowrap px-6 py-2.5 rounded-full text-sm font-bold transition-all bg-adex-darkBlue text-white shadow-md";
                } else {
                    btn.className = "whitespace-nowrap px-6 py-2.5 rounded-full text-sm font-semibold transition-all bg-white text-slate-600 border border-slate-200 hover:bg-slate-50";
                }
            });
            renderCards();
        }

        // 5. CAMBIO DE VISTAS (Directorio / Favoritos)
        function changeView(viewType) {
            state.view = viewType;
            state.category = 'Todas';
            state.search = '';
            document.getElementById('search-input').value = '';
            
            document.getElementById('view-title').textContent = viewType === 'all' ? "Directorio Completo" : "Mis Favoritos";
            document.getElementById('view-desc').textContent = viewType === 'all' ? "Toca cualquier tarjeta para abrirla." : "Tus herramientas guardadas.";

            // Animación del indicador del Bottom Nav
            const indicator = document.getElementById('nav-indicator');
            if (viewType === 'all') {
                indicator.style.transform = 'translateX(0)';
                document.getElementById('nav-btn-all').classList.replace('text-slate-400', 'text-adex-blue');
                document.getElementById('icon-all').classList.replace('ph-bold', 'ph-fill');
                
                document.getElementById('nav-btn-fav').classList.replace('text-yellow-500', 'text-slate-400');
                document.getElementById('icon-fav').classList.replace('ph-fill', 'ph-bold');
            } else {
                indicator.style.transform = 'translateX(100%)';
                document.getElementById('nav-btn-fav').classList.replace('text-slate-400', 'text-yellow-500');
                document.getElementById('icon-fav').classList.replace('ph-bold', 'ph-fill');
                
                document.getElementById('nav-btn-all').classList.replace('text-adex-blue', 'text-slate-400');
                document.getElementById('icon-all').classList.replace('ph-fill', 'ph-bold');
            }

            setCategory('Todas'); // Resetea las píldoras
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 6. LÓGICA DE FAVORITOS (Estrellas)
        function toggleFavorite(id, event) {
            event.preventDefault(); // Evita abrir el link
            event.stopPropagation(); // Evita que el clic suba al contenedor
            
            const index = state.favorites.indexOf(id);
            const iconEl = document.getElementById(`star-icon-${id}`);

            if (index > -1) {
                // Quitar
                state.favorites.splice(index, 1);
                iconEl.className = "ph-bold ph-star text-3xl text-slate-300 transition-colors";
            } else {
                // Agregar
                state.favorites.push(id);
                iconEl.className = "ph-fill ph-star text-3xl text-yellow-400 drop-shadow-md";
                
                // Animación
                const btn = iconEl.parentElement;
                btn.classList.add('star-animated');
                setTimeout(() => btn.classList.remove('star-animated'), 500); 
            }
            
            localStorage.setItem('adexFavs_EricMozombite_v2', JSON.stringify(state.favorites));
            updateFavIndicators();
            
            if (state.view === 'favorites') {
                setTimeout(renderCards, 300);
            }
        }

        function updateFavIndicators() {
            const count = state.favorites.length;
            const badge = document.getElementById('fav-badge');
            badge.textContent = count;
            count > 0 ? badge.classList.remove('hidden') : badge.classList.add('hidden');
        }

        // 7. RENDERIZADO DE FICHAS (Tarjetas Interactivas)
        function renderCards() {
            const grid = document.getElementById('tools-grid');
            const emptyState = document.getElementById('empty-state');
            grid.innerHTML = '';
            
            const filteredData = toolsData.filter(tool => {
                if (state.view === 'favorites' && !state.favorites.includes(tool.id)) return false;
                if (state.view === 'all' && state.category !== 'Todas' && tool.cat !== state.category) return false;
                if (state.search) {
                    const term = state.search;
                    return tool.name.toLowerCase().includes(term) || tool.desc.toLowerCase().includes(term) || tool.tags.join(' ').toLowerCase().includes(term);
                }
                return true;
            });

            document.getElementById('results-count').textContent = `${filteredData.length} herramientas`;

            if (filteredData.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
                
                if (state.view === 'favorites') {
                    document.getElementById('empty-icon').className = "ph-fill ph-star text-yellow-400 text-6xl drop-shadow-lg";
                    document.getElementById('empty-title').textContent = "Lista vacía";
                    document.getElementById('empty-desc').textContent = "Toca la estrella en cualquier ficha para guardarla aquí.";
                } else {
                    document.getElementById('empty-icon').className = "ph-duotone ph-magnifying-glass-minus text-slate-300 text-6xl";
                    document.getElementById('empty-title').textContent = "Sin resultados";
                    document.getElementById('empty-desc').textContent = "Intenta usar otra palabra clave en el buscador.";
                }
                return;
            }

            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');
            emptyState.classList.remove('flex');

            filteredData.forEach((tool, i) => {
                const isFav = state.favorites.includes(tool.id);
                const starIcon = isFav ? "ph-fill ph-star text-3xl text-yellow-400 drop-shadow-md" : "ph-bold ph-star text-3xl text-slate-300 hover:text-yellow-400 transition-colors";

                const card = document.createElement('div');
                // Al tocar CUALQUIER PARTE de la tarjeta se abre el enlace (excepto la estrella)
                card.onclick = () => window.open(tool.url, '_blank');
                card.className = "tool-card bg-white rounded-3xl p-6 border border-slate-200 shadow-card cursor-pointer flex flex-col h-full relative group animate-enter";
                card.style.animationDelay = `${i * 0.04}s`; 
                
                card.innerHTML = `
                    <!-- Botón Estrella Independiente -->
                    <button onclick="toggleFavorite('${tool.id}', event)" class="star-btn absolute top-5 right-5 z-20" aria-label="Favorito">
                        <i id="star-icon-${tool.id}" class="${starIcon}"></i>
                    </button>

                    <!-- Icono -->
                    <div class="w-16 h-16 rounded-2xl bg-slate-50 border border-slate-100 flex items-center justify-center text-adex-blue mb-5 group-hover:bg-adex-blue group-hover:text-white transition-colors duration-300">
                        <i class="ph-duotone ${tool.icon} text-4xl"></i>
                    </div>
                    
                    <!-- Textos -->
                    <span class="text-[10px] font-black uppercase tracking-widest text-adex-red mb-1.5">${tool.cat}</span>
                    <h3 class="text-xl font-black text-slate-900 mb-2 leading-tight">${tool.name}</h3>
                    <p class="text-sm text-slate-500 font-medium leading-relaxed flex-grow pr-4">${tool.desc}</p>
                    
                    <!-- Footer: Etiquetas -->
                    <div class="mt-6 pt-5 border-t border-slate-100 flex items-center justify-between">
                        <div class="flex flex-wrap gap-2">
                            ${tool.tags.map(tag => `<span class="bg-slate-50 text-slate-500 text-[10px] font-bold px-2.5 py-1.5 rounded-lg border border-slate-200">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        init();
    </script>
</body>
</html>
